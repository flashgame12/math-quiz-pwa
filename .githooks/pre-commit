#!/usr/bin/env bash
set -euo pipefail

repo_root="$(git rev-parse --show-toplevel)"

if [[ "${SKIP_BUILD_BUMP:-}" == "1" ]]; then
	exit 0
fi

# Bump BUILD_ID on every commit so devices show a clear version.
commit_count=0
if git rev-parse --verify HEAD >/dev/null 2>&1; then
	commit_count="$(git rev-list --count HEAD)"
fi

next_build="$((commit_count + 1))"
python3 "$repo_root/scripts/bump_build.py" "$repo_root/app.js" "$next_build" >/dev/null

git add "$repo_root/app.js"
